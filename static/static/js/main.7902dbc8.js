(()=>{"use strict";var e={74305:(e,t,s)=>{var a=s(56471),n=s(59108),r=s(1827),o=s(78440),l=s(48396),i=s(92920),c=s(46085),d=s(1316),h=s(51774),u=s(39437),m=s(77934),g=s(29251),x=s(6916);const p=e=>x.A.sanitize(e),f=e=>x.A.sanitize(e).replace(/[^a-zA-Z0-9_\-. ]/g,""),b=e=>e.map((e=>x.A.sanitize(e))),j=e=>{const t={};for(const s in e)void 0!==e[s]&&("string"===typeof e[s]?t[s]=x.A.sanitize(e[s]):t[s]=e[s]);return t},y=g.A.create({baseURL:"http://192.168.1.27:8000/",headers:{"Content-Type":"application/json"},timeout:1e4});y.interceptors.response.use((e=>e),(e=>{var t,s,a;if(console.error("API request failed:",{url:null===(t=e.config)||void 0===t?void 0:t.url,method:null===(s=e.config)||void 0===s?void 0:s.method,status:null===(a=e.response)||void 0===a?void 0:a.status,message:e.message}),e.response)switch(e.response.status){case 400:return Promise.reject(new Error("Invalid request. Please check your input and try again."));case 401:return Promise.reject(new Error("You need to log in to perform this action."));case 403:return Promise.reject(new Error("You don't have permission to perform this action."));case 404:return Promise.reject(new Error("The requested resource was not found."));case 429:return Promise.reject(new Error("Too many requests. Please try again later."));case 500:case 502:case 503:case 504:return Promise.reject(new Error("Server error. Please try again later."));default:return Promise.reject(new Error("An unexpected error occurred. Please try again later."))}return"ECONNABORTED"===e.code?Promise.reject(new Error("Request timeout. Please check your connection and try again.")):navigator.onLine?Promise.reject(new Error("An error occurred while connecting to the server. Please try again later.")):Promise.reject(new Error("You are offline. Please check your internet connection."))}));const v={getRoots:async()=>(await y.get("/folders/roots")).data,getAll:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15,s=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;const n=s?f(s):void 0,r=a?p(a):void 0,o=j({root:n,per_page:t,page:e,searchby:r});return(await y.get("/folders/json",{params:o})).data},getByName:async e=>{const t=f(e),s=await y.get(`/folders/json/name/${t}`);return s.data[0]?s.data[0]:null},delete:async e=>{const t=f(e),s=await y.post("/folders/delete",{folder_name:t});if(s.data&&1!==s.data.rows)throw new Error("Error while deleting folder")},updateTags:async(e,t)=>{const s=f(e),a=b(t),n=await y.post("/tags/assign/folder",{tags:a,folder_name:s});return n.data.tags?n.data.tags:[]}},w={getAllByFolder:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const a=f(e),n=j({folder:a,per_page:t,page:s});return(await y.get("/files/json",{params:n})).data},getRandomByTag:async(e,t,s)=>{let a={};if(e){a={tag:f(e),equal:s,size:t}}return(await y.get("/files/random/json",{params:a})).data},getRandomByFolder:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;const s=f(e),a=j({size:t,folder:s});return(await y.get("/files/random/json",{params:a})).data},updateTags:async(e,t)=>{const s=p(e),a=b(t),n=await y.post("/tags/assign",{tags:a,image_hash:s});return n.data.tags?n.data.tags:[]}},N={getAll:async e=>{let t={};if(e){t={folder:f(e)}}return(await y.get("/tags",{params:t})).data}},C={indexPhotos:async()=>(await y.get("/files/task/index")).data,cancelIndexTask:async()=>(await y.get("/files/task/cancel")).data};var k=s(81743);const S=(0,a.createContext)({}),A=e=>{let{children:t}=e;const[s,n]=(0,a.useState)([]),[o,l]=(0,a.useState)([]),[i,c]=(0,a.useState)([]),[d,h]=(0,a.useState)([]),[u,m]=(0,a.useState)(!0),[g,x]=(0,a.useState)(""),[p,f]=(0,a.useState)("files"),[b,j]=(0,a.useState)(!1),[y,w]=(0,a.useState)(1),[A,E]=(0,a.useState)(!0),I=(0,a.useRef)(null),P=(0,r.zy)(),T=(0,r.Zp)(),z=(0,a.useCallback)(((e,t)=>{const s=((e,t,s)=>{const a=new URLSearchParams(e.search);return t?a.set("searchBy",t):a.delete("searchBy"),s?a.set("root",s):a.delete("root"),a.toString()})(P,e,t),a=`${P.pathname}${s?`?${s}`:""}`;T(a,{replace:!0})}),[P,T]),$=(0,a.useCallback)((async()=>{try{const e=await C.indexPhotos();j(e.task_running),!e.task_running&&I.current&&(clearInterval(I.current),I.current=null,await D())}catch(e){console.error("Failed to check indexation status:",e)}}),[]);(0,a.useEffect)((()=>()=>{I.current&&(clearInterval(I.current),I.current=null)}),[]);const O=(0,a.useCallback)((async(e,t,s)=>{m(!0);try{const a=await v.getAll(e,8,t||"",s),n=8===a.length;return E(n),a}catch(a){return console.error("Failed to fetch folders:",a),[]}finally{m(!1)}}),[]),D=(0,a.useCallback)((async()=>{w(1);const e=await O(1,p,g);n(e),h(e)}),[O,p,g]),R=(0,a.useCallback)((async()=>{if(!A||u)return;const e=y+1,t=await O(e,p,g);t.length>0&&(n((e=>[...e,...t])),h((e=>[...e,...t])),w(e))}),[O,A,u,y,p,g]);(0,a.useEffect)((()=>{const e=new URLSearchParams(P.search),t=e.get("root"),s=e.get("searchBy");t!==p&&f(t?p:"files"),s!==g&&x(s||""),w(1),D()}),[P.search]),(0,a.useEffect)((()=>{(async()=>{try{const e=await v.getRoots();l(e)}catch(e){console.error("Failed to fetch roots:",e)}})()}),[]),(0,a.useEffect)((()=>{(async()=>{try{const e=await N.getAll();c(e)}catch(e){console.error("Failed to fetch tags:",e)}})()}),[]);const F=(0,a.useCallback)((async(e,t)=>{try{const s=await v.updateTags(e,t);n((t=>t.map((t=>t.title===e?{...t,tags:s}:t)))),h((t=>t.map((t=>t.title===e?{...t,tags:s}:t))))}catch(s){throw console.error("Failed to update tags:",s),s}}),[]),M=(0,a.useCallback)((async e=>{try{await v.delete(e),n((t=>t.filter((t=>t.title!==e)))),h((t=>t.filter((t=>t.title!==e))))}catch(t){throw console.error(`Failed to delete folder ${e}:`,t),t}}),[]),_=(0,a.useCallback)((async()=>{I.current&&(clearInterval(I.current),I.current=null),j(!0);try{(await C.indexPhotos()).task_running||(I.current=setInterval($,3e4),await D()),await new Promise((e=>setTimeout(e,2e3)))}catch(e){throw console.error("Indexation failed:",e),j(!1),e}}),[D,$]),B=(0,a.useCallback)((async()=>{try{const e=await C.cancelIndexTask();I.current&&(clearInterval(I.current),I.current=null),"success"===e.status&&(j(!1),await D())}catch(e){throw console.error("Failed to cancel indexation:",e),e}}),[D]),L=(0,a.useCallback)((e=>{x(e),z(e,p)}),[p,z]),q=(0,a.useCallback)((e=>{f(e),z(g,e)}),[g,z]);return(0,k.jsx)(S.Provider,{value:{folders:s,roots:o,tags:i,filteredFolders:d,loading:u,searchQuery:g,selectedRoot:p,setSearchQuery:L,setSelectedRoot:q,refreshFolders:D,updateFolderTags:F,deleteFolder:M,isIndexing:b,startIndexation:_,cancelIndexation:B,hasMore:A,loadMoreFolders:R,page:y},children:t})},E=()=>(0,a.useContext)(S),I=(e,t,s,a)=>`thumb_${t}_${e}_${s}x${a}`,P=(e,t,s,a)=>`http://192.168.1.27:8000/folders/thumbnail/folder/download?number=${e}&folder=${t}&width=${s}&height=${a}`,T=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:300,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:400;try{const n=P(e,t,s,a),r=I(e,t,s,a),o=localStorage.getItem("thumbnailCache"),l=o?JSON.parse(o):{};l[r]={url:n,timestamp:Date.now(),width:s,height:a},O(l),localStorage.setItem("thumbnailCache",JSON.stringify(l))}catch(n){console.error("Error caching image URL:",n)}},z=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:300,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:400;try{const n=I(e,t,s,a),r=localStorage.getItem("thumbnailCache");if(!r)return null;const o=JSON.parse(r),l=o[n];return l&&Date.now()-l.timestamp<6048e5?l.url:(l&&(delete o[n],localStorage.setItem("thumbnailCache",JSON.stringify(o))),null)}catch(n){return console.error("Error retrieving cached image URL:",n),null}},$=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:300,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:400;return new Promise(((n,r)=>{let o=z(e,t,s,a);o||(o=P(e,t,s,a),T(e,t,s,a));const l=new Image;l.onload=()=>n(),l.onerror=()=>r(new Error("Failed to preload image")),l.src=o}))},O=e=>{const t=Object.keys(e);if(t.length<=2e3)return;t.sort(((t,s)=>e[t].timestamp-e[s].timestamp)).slice(0,t.length-2e3).forEach((t=>{delete e[t]}))},D=()=>{try{const e=localStorage.getItem("thumbnailCache");if(!e)return{size:0,oldestEntry:0,newestEntry:0};const t=JSON.parse(e),s=Object.keys(t);if(0===s.length)return{size:0,oldestEntry:0,newestEntry:0};const a=s.map((e=>t[e].timestamp));return{size:s.length,oldestEntry:Math.min(...a),newestEntry:Math.max(...a)}}catch(e){return console.error("Error getting cache stats:",e),{size:0,oldestEntry:0,newestEntry:0}}},R=()=>{const[e,t]=(0,a.useState)({size:0,oldestEntry:0,newestEntry:0});(0,a.useEffect)((()=>{t(D());const e=e=>{"thumbnailCache"!==e.key&&null!==e.key||t(D())};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)}),[]);const s=(0,a.useCallback)((function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:300,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:400;const n=z(e,t,s,a);if(n)return n;const r=P(e,t,s,a);return T(e,t,s,a),r}),[]),n=(0,a.useCallback)((function(e,s){T(e,s,arguments.length>2&&void 0!==arguments[2]?arguments[2]:300,arguments.length>3&&void 0!==arguments[3]?arguments[3]:400),t(D())}),[]),r=(0,a.useCallback)((async function(e,s){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:300,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:400;await $(e,s,a,n),t(D())}),[]),o=(0,a.useCallback)((()=>{localStorage.removeItem("thumbnailCache"),t(D())}),[]);return{getImageUrl:s,cacheImage:n,preload:r,preloadBatch:(0,a.useCallback)((async function(e,s){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:300,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:400;for(let t=0;t<e.length;t+=5){const r=e.slice(t,t+5);await Promise.all(r.map((e=>$(e,s,a,n))))}t(D())}),[]),clearCache:o,stats:e}},F=e=>{let{onClose:t}=e;const{stats:s,clearCache:n}=R(),[r,o]=(0,a.useState)([]);(0,a.useEffect)((()=>{try{const e=localStorage.getItem("thumbnailCache");if(!e)return;const t=JSON.parse(e),s=[];Object.keys(t).forEach((e=>{const a=e.split("_");if(a.length>=3){const n=a[1],r=parseInt(a[2],10);s.push({key:e,folderName:n,thumbnail:r,timestamp:t[e].timestamp,url:t[e].url})}}));const a=s.sort(((e,t)=>t.timestamp-e.timestamp)).slice(0,6);o(a)}catch(e){console.error("Error loading cached items:",e)}}),[s.size]);const l=e=>0===e?"N/A":new Date(e).toLocaleString();return(0,k.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,k.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg",children:[(0,k.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Image Cache Manager"}),(0,k.jsxs)("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[(0,k.jsx)("h3",{className:"font-semibold mb-2",children:"Cache Statistics"}),(0,k.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,k.jsxs)("div",{children:[(0,k.jsxs)("p",{children:[(0,k.jsx)("strong",{children:"Cached Images:"})," ",s.size]}),(0,k.jsxs)("p",{children:[(0,k.jsx)("strong",{children:"Estimated Size:"})," ",(e=>{const t=200*e;return t<1024?`${t} bytes`:t<1048576?`${(t/1024).toFixed(2)} KB`:`${(t/1048576).toFixed(2)} MB`})(s.size)]})]}),(0,k.jsxs)("div",{children:[(0,k.jsxs)("p",{children:[(0,k.jsx)("strong",{children:"Oldest Cached:"})," ",l(s.oldestEntry)]}),(0,k.jsxs)("p",{children:[(0,k.jsx)("strong",{children:"Newest Cached:"})," ",l(s.newestEntry)]})]})]})]}),r.length>0&&(0,k.jsxs)("div",{className:"mb-6",children:[(0,k.jsx)("h3",{className:"font-semibold mb-2",children:"Recent Cached Thumbnails"}),(0,k.jsx)("div",{className:"grid grid-cols-3 gap-2",children:r.map((e=>(0,k.jsxs)("div",{className:"relative overflow-hidden rounded h-20 bg-gray-200",children:[(0,k.jsx)("img",{src:e.url,alt:`${e.folderName} thumbnail`,className:"w-full h-full object-cover"}),(0,k.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white text-xs p-1 truncate",children:e.folderName})]},e.key)))})]}),(0,k.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,k.jsx)("button",{className:"px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition",onClick:()=>{window.confirm("Are you sure you want to clear the thumbnail cache?")&&(n(),o([]))},children:"Clear Cache"}),(0,k.jsx)("button",{className:"px-4 py-2 bg-gray-300 rounded hover:bg-gray-400 transition",onClick:t,children:"Close"})]})]})})},M=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:768;const[t,s]=(0,a.useState)("undefined"!==typeof window&&window.innerWidth<e);return(0,a.useEffect)((()=>{if("undefined"===typeof window)return;const t=()=>{s(window.innerWidth<e)};return window.addEventListener("resize",t),t(),()=>window.removeEventListener("resize",t)}),[e]),t},_=e=>{let{onTagClick:t,onApiDocsClick:s,isOpen:n=!1,onClose:g}=e;const[x,p]=(0,a.useState)(n),[f,b]=(0,a.useState)(!1),j=M(),{folders:y,roots:v,tags:w,searchQuery:N,setSearchQuery:C,selectedRoot:S,setSelectedRoot:A,isIndexing:I,startIndexation:P,cancelIndexation:T}=E(),z=(0,r.Zp)();(0,a.useEffect)((()=>{p(n)}),[n]);const $=v.reduce(((e,t)=>e+t.photo_count),0),O=w.sort(),D=e=>{e&&(console.log("Click on: "+e),A(e))};return(0,k.jsxs)("div",{className:"mb-6 menu-section","data-open":x?"true":"false",children:[(0,k.jsxs)("div",{className:(j?"flex flex-col space-y-3":"flex justify-between items-center")+" mb-4",children:[(0,k.jsxs)("div",{className:""+(j?"flex flex-wrap gap-2":"flex space-x-2"),children:[(0,k.jsxs)("button",{onClick:()=>{const e=!x;p(e),!e&&g&&g()},className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition flex items-center",children:[(0,k.jsx)(o.A,{size:16,className:"mr-2"}),x?"Hide Menu":"Show Menu"]}),(0,k.jsx)("button",{onClick:P,disabled:I,className:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition flex items-center "+(I?"opacity-75 cursor-not-allowed":""),children:I?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(l.A,{size:16,className:"mr-2 animate-spin"}),"Indexing..."]}):(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(l.A,{size:16,className:"mr-2"}),"Index New Photos"]})}),(0,k.jsx)("button",{onClick:T,disabled:!I,hidden:!I,className:"px-4 py-2 rounded-md transition-colors "+(I?"bg-red-500 hover:bg-red-600 text-white":"bg-gray-300 cursor-not-allowed"),children:"Cancel Indexation"}),(0,k.jsxs)("button",{onClick:()=>{s?s():z("/api-docs")},className:"px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 transition flex items-center",children:[(0,k.jsx)(i.A,{size:16,className:"mr-2"}),"API Docs"]}),(0,k.jsxs)("button",{onClick:()=>{b(!f)},className:"px-4 py-2 bg-teal-500 text-white rounded hover:bg-teal-600 transition flex items-center",children:[(0,k.jsx)(c.A,{size:16,className:"mr-2"}),"Manage Cache"]})]}),(0,k.jsxs)("div",{className:"relative "+(j?"w-full":"w-full max-w-md ml-4"),children:[(0,k.jsx)(d.A,{size:16,className:"absolute left-3 top-3 text-gray-400"}),(0,k.jsx)("input",{type:"text",value:N||"",onChange:e=>C(e.target.value),placeholder:"Search folders...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded"}),N&&(0,k.jsx)("button",{onClick:()=>C(""),className:"absolute right-3 top-3 text-gray-400 hover:text-gray-600",children:(0,k.jsx)(h.A,{size:16})})]})]}),x&&(0,k.jsx)("div",{className:"bg-white p-4 rounded-lg shadow-md mb-6 transition-all",children:(0,k.jsxs)("div",{className:`grid grid-cols-1 ${j?"":"md:grid-cols-3"} gap-4`,children:[(0,k.jsxs)("div",{children:[(0,k.jsxs)("h3",{className:"text-lg font-semibold mb-2 flex items-center",children:[(0,k.jsx)(u.A,{size:18,className:"mr-2"}),"Statistics"]}),(0,k.jsxs)("ul",{className:"space-y-1",children:[(0,k.jsxs)("li",{className:"flex items-center",children:[(0,k.jsx)("span",{className:"mr-2",children:"\u2022"}),"Total Albums:"," ",(0,k.jsx)("span",{className:"font-medium ml-2",children:y.length})]}),(0,k.jsxs)("li",{className:"flex items-center",children:[(0,k.jsx)("span",{className:"mr-2",children:"\u2022"}),"Total Photos:"," ",(0,k.jsx)("span",{className:"font-medium ml-2",children:$})]}),(0,k.jsxs)("li",{className:"flex items-center",children:[(0,k.jsx)("span",{className:"mr-2",children:"\u2022"}),"Total Roots:"," ",(0,k.jsx)("span",{className:"font-medium ml-2",children:v.length})]}),(0,k.jsxs)("li",{className:"flex items-center",children:[(0,k.jsx)("span",{className:"mr-2",children:"\u2022"}),"Total Tags:"," ",(0,k.jsx)("span",{className:"font-medium ml-2",children:O.length})]})]})]}),(0,k.jsxs)("div",{children:[(0,k.jsxs)("h3",{className:"text-lg font-semibold mb-2 flex items-center",children:[(0,k.jsx)(u.A,{size:18,className:"mr-2"}),"Roots"]}),(0,k.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,k.jsx)("div",{className:"px-3 py-2 rounded cursor-pointer "+(S?"bg-gray-100 hover:bg-gray-200":"bg-blue-500 text-white"),onClick:()=>D(""),children:"All Roots"}),v.map((e=>(0,k.jsx)("div",{className:"px-3 py-2 rounded cursor-pointer "+(S===e.root?"bg-blue-500 text-white":"bg-gray-100 hover:bg-gray-200"),onClick:()=>D(e.root),children:e.root},e.root)))]})]}),(0,k.jsxs)("div",{children:[(0,k.jsxs)("h3",{className:"text-lg font-semibold mb-2 flex items-center",children:[(0,k.jsx)(m.A,{size:18,className:"mr-2"}),"Available Tags"]}),O.length>0?(0,k.jsx)("div",{className:"flex flex-wrap gap-2",children:O.map((e=>(0,k.jsx)("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-sm rounded-full cursor-pointer hover:bg-blue-200",onClick:()=>{return s="tag",a=e,void(t?t(s,a):"tag"===s?z(`/tag/${a}`):"root"===s&&(z("/",{state:{selectedRoot:a}}),A(a)));var s,a},children:e},e)))}):(0,k.jsx)("p",{className:"text-gray-500",children:"No tags available"})]})]})}),f&&(0,k.jsx)(F,{onClose:()=>b(!1)})]})},B=a.memo(_);var L=s(46535),q=s(46719),Z=s(89942);const U=e=>{let{thumbnails:t,folderName:s}=e;const[n,r]=(0,a.useState)(0),[o,l]=(0,a.useState)({}),[i,c]=(0,a.useState)(!1),[d,h]=(0,a.useState)(null),u=(0,a.useCallback)((function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const a=t?150:300,n=t?200:400,r=z(e,s,a,n);if(r)return r;const o=P(e,s,a,n);return T(e,s,a,n),o}),[s]);(0,a.useEffect)((()=>{l({})}),[t]),(0,a.useEffect)((()=>{if(i||0===t.length)return;const e=setInterval((()=>{r((e=>(e+1)%t.length))}),5e3);return()=>clearInterval(e)}),[t.length,i]),(0,a.useEffect)((()=>{if(0===t.length)return;(async()=>{try{for(let e=1;e<=2;e++){const a=(n+e)%t.length;await $(t[a],s)}}catch(e){console.error("Error preloading images:",e)}})()}),[n,t,s]);const m=e=>!!o[e];return(0,k.jsxs)("div",{className:"relative h-64 bg-gray-200 overflow-hidden",onTouchStart:e=>{c(!0),h(e.touches[0].clientX)},onTouchMove:e=>{},onTouchEnd:e=>{if(null===d)return void c(!1);const s=e.changedTouches[0].clientX,a=d-s;Math.abs(a)>50&&r(a>0?e=>(e+1)%t.length:e=>(e-1+t.length)%t.length),h(null),c(!1)},children:[t.map(((e,t)=>{const s=u(e),a=u(e,!0);return(0,k.jsx)("img",{srcSet:`${a} 1x, ${s} 2x`,src:s,alt:`Thumbnail ${t+1}`,className:`absolute inset-0 w-full h-full object-cover transition-opacity duration-1000 ${t===n?"opacity-100":"opacity-0"} ${m(t)?"block":"hidden"}`,onLoad:()=>(e=>{l((t=>({...t,[e]:!0})))})(t)},t)})),!m(n)&&(0,k.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-200",children:(0,k.jsx)("div",{className:"w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"})}),(0,k.jsx)("div",{className:"absolute bottom-2 left-0 right-0 flex justify-center gap-1",children:t.map(((e,t)=>(0,k.jsx)("button",{onClick:()=>r(t),className:"w-2 h-2 rounded-full border-none focus:outline-none "+(t===n?"bg-white":"bg-white bg-opacity-50"),"aria-label":`Go to slide ${t+1}`},t)))}),(0,k.jsx)("div",{className:"absolute inset-0 pointer-events-none flex items-center",children:(0,k.jsx)("div",{className:"w-6 h-12 mx-auto opacity-0 bg-white bg-opacity-20 rounded-full flex items-center justify-center",children:(0,k.jsx)("div",{className:"animate-pulse",children:"\u27f7"})})})]})},J=e=>{let{folder:t,onView:s,onTagClick:a,onTagManage:n,onRandomPhoto:r,onDelete:o}=e;return(0,k.jsxs)("div",{className:"bg-white shadow-md overflow-hidden",children:[(0,k.jsxs)("div",{className:"relative",children:[(0,k.jsx)(U,{thumbnails:[1,2,3],folderName:t.title},`thumbnail-${t.title}-${Date.now()}`),(0,k.jsx)("div",{className:"absolute top-2 right-2 px-2 py-1 bg-blue-500 text-white text-xs rounded cursor-pointer hover:bg-blue-600",onClick:e=>{e.stopPropagation(),a("root",t.root)},children:t.root})]}),(0,k.jsxs)("div",{className:"p-4",children:[(0,k.jsxs)("div",{className:"flex justify-between items-start",children:[(0,k.jsx)("h2",{className:"text-xl font-semibold mb-2",children:t.title}),(0,k.jsx)("button",{onClick:e=>{e.stopPropagation(),o(t)},className:"p-2 text-red-500 hover:bg-red-100 rounded-full",title:"Delete album","aria-label":"Delete album",children:(0,k.jsx)(L.A,{size:18})})]}),(0,k.jsxs)("p",{className:"text-gray-600 mb-2 flex items-center",children:[(0,k.jsx)(q.A,{size:16,className:"mr-1"}),(0,k.jsxs)("span",{children:[t.photo_count," photos"]})]}),t.tags.length>0&&(0,k.jsx)("div",{className:"mb-4 flex flex-wrap gap-2",children:t.tags.map((e=>(0,k.jsx)("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-sm rounded-full cursor-pointer hover:bg-blue-200",onClick:t=>{t.stopPropagation(),a("tag",e)},children:e},e)))}),(0,k.jsxs)("div",{className:"grid grid-cols-2 gap-2 mt-4",children:[(0,k.jsxs)("button",{onClick:()=>s(t.title),className:"px-3 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition flex items-center justify-center",children:[(0,k.jsx)(Z.A,{size:16,className:"mr-1"})," View Album"]}),(0,k.jsxs)("button",{onClick:()=>r(t.title),className:"px-3 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition flex items-center justify-center",children:[(0,k.jsx)(q.A,{size:16,className:"mr-1"})," Random Photo"]}),(0,k.jsxs)("button",{onClick:()=>n(t),className:"px-3 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 transition flex items-center justify-center col-span-2",children:[(0,k.jsx)(m.A,{size:16,className:"mr-1"})," Manage Tags"]})]})]})]})};var H=s(5279),Q=s(55890);const V=e=>{let{onHomeClick:t,onRootClick:s,onTagsClick:n,onIndexClick:r,onApiDocsClick:o,isIndexing:d}=e;const[g,x]=(0,a.useState)(!1),[p,f]=(0,a.useState)(!1),b=()=>{x(!g)};return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("button",{onClick:b,className:"fixed bottom-4 right-4 z-40 w-14 h-14 rounded-full bg-blue-500 text-white shadow-lg flex items-center justify-center",children:g?(0,k.jsx)(h.A,{size:24}):(0,k.jsx)(H.A,{size:24})}),g&&(0,k.jsx)("div",{className:"fixed bottom-20 right-4 z-40 bg-white rounded-lg shadow-xl overflow-hidden",children:(0,k.jsxs)("div",{className:"flex flex-col w-56",children:[(0,k.jsxs)("button",{onClick:()=>{t(),b()},className:"flex items-center px-4 py-3 hover:bg-gray-100 transition",children:[(0,k.jsx)(Q.A,{size:18,className:"mr-3"}),(0,k.jsx)("span",{children:"Home"})]}),(0,k.jsxs)("button",{onClick:()=>{s(),b()},className:"flex items-center px-4 py-3 hover:bg-gray-100 transition",children:[(0,k.jsx)(u.A,{size:18,className:"mr-3"}),(0,k.jsx)("span",{children:"Roots"})]}),(0,k.jsxs)("button",{onClick:()=>{n(),b()},className:"flex items-center px-4 py-3 hover:bg-gray-100 transition",children:[(0,k.jsx)(m.A,{size:18,className:"mr-3"}),(0,k.jsx)("span",{children:"Tags"})]}),(0,k.jsxs)("button",{onClick:()=>{r(),b()},disabled:d,className:"flex items-center px-4 py-3 hover:bg-gray-100 transition "+(d?"opacity-50":""),children:[(0,k.jsx)(l.A,{size:18,className:"mr-3 "+(d?"animate-spin":"")}),(0,k.jsx)("span",{children:d?"Indexing...":"Index Photos"})]}),(0,k.jsxs)("button",{onClick:()=>{f(!0),b()},className:"flex items-center px-4 py-3 hover:bg-gray-100 transition",children:[(0,k.jsx)(c.A,{size:18,className:"mr-3"}),(0,k.jsx)("span",{children:"Manage Cache"})]}),o&&(0,k.jsxs)("button",{onClick:()=>{o(),b()},className:"flex items-center px-4 py-3 hover:bg-gray-100 transition",children:[(0,k.jsx)(i.A,{size:18,className:"mr-3"}),(0,k.jsx)("span",{children:"API Docs"})]})]})}),p&&(0,k.jsx)(F,{onClose:()=>f(!1)})]})},K=e=>{let{folder:t,onCancel:s,onConfirm:a}=e;return(0,k.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,k.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[(0,k.jsx)("h3",{className:"text-xl font-bold mb-2",children:"Delete Folder"}),(0,k.jsxs)("p",{className:"mb-4",children:['Are you sure you want to delete "',t.title,'"? This action cannot be undone.']}),(0,k.jsxs)("div",{className:"flex justify-end gap-2 mt-6",children:[(0,k.jsx)("button",{onClick:s,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 transition",children:"Cancel"}),(0,k.jsxs)("button",{onClick:a,className:"px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition flex items-center",children:[(0,k.jsx)(L.A,{size:16,className:"mr-2"}),"Delete Folder"]})]})]})})},X=a.memo(K),Y=e=>{let{folder:t,onCancel:s,onSave:n}=e;const[r,o]=(0,a.useState)({...t,tags:[...t.tags]}),{tags:l,updateFolderTags:i}=E(),c=M();(0,a.useEffect)((()=>{o({...t,tags:[...t.tags]})}),[t]);const d=async e=>{var t;const s={...r};null!==(t=s.tags)&&void 0!==t&&t.includes(e)?s.tags=s.tags.filter((t=>t!==e)):s.tags=[...s.tags,e];try{await i(s.title,s.tags),o(s)}catch(a){console.error("Failed to update tags:",a)}};return(0,k.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,k.jsxs)("div",{className:`bg-white rounded-lg p-6 w-full ${c?"max-h-[85vh]":"max-w-2xl max-h-[90vh]"} overflow-hidden flex flex-col`,children:[(0,k.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,k.jsxs)("h3",{className:"text-xl font-bold",children:['Manage Tags for "',r.title,'"']}),(0,k.jsx)("button",{onClick:s,className:"p-2 rounded-full hover:bg-gray-200",children:(0,k.jsx)(h.A,{size:24})})]}),(0,k.jsxs)("div",{className:"mb-4",children:[(0,k.jsx)("h4",{className:"font-semibold mb-2",children:"Current Tags"}),r.tags&&r.tags.length>0?(0,k.jsx)("div",{className:"flex flex-wrap gap-2 mb-4",children:r.tags.map((e=>(0,k.jsxs)("span",{className:"px-3 py-1 bg-blue-500 text-white text-sm rounded-full flex items-center",children:[e,(0,k.jsx)("button",{onClick:()=>d(e),className:"ml-2 bg-blue-600 rounded-full p-1 hover:bg-blue-700 min-h-0 min-w-0",children:(0,k.jsx)(h.A,{size:12})})]},e)))}):(0,k.jsx)("p",{className:"text-gray-500 mb-4",children:"No tags assigned to this album yet."})]}),(0,k.jsxs)("div",{className:"overflow-auto flex-grow",children:[(0,k.jsx)("h4",{className:"font-semibold mb-2",children:"Available Tags"}),(0,k.jsx)("div",{className:`grid ${c?"grid-cols-1 sm:grid-cols-2":"grid-cols-2 sm:grid-cols-3"} gap-2`,children:l.filter((e=>!r.tags||!r.tags.includes(e))).map((e=>(0,k.jsxs)("div",{className:"px-3 py-2 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-100 hover:border-blue-500 flex items-center",onClick:()=>d(e),children:[(0,k.jsx)("span",{className:"mr-2 w-4 h-4 flex items-center justify-center bg-gray-200 text-gray-700 rounded-full",children:"+"})," ",e]},e)))})]}),(0,k.jsxs)("div",{className:"flex justify-end gap-2 mt-6 pt-4 border-t",children:[(0,k.jsx)("button",{onClick:s,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 transition",children:"Cancel"}),(0,k.jsx)("button",{onClick:n,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition",children:"Save Changes"})]})]})})},G=a.memo(Y);var W=s(90601);const ee=e=>{let{images:t,hidden:s,openNow:n}=e;const{open:r,close:o}=(0,W.iX)(),[l,i]=(0,a.useState)({}),c=e=>!!l[e];return(0,a.useEffect)((()=>{s&&r(0);const e=setTimeout((()=>{t.length>0&&n&&r(0)}),100);return()=>(o(),clearTimeout(e))}),[r,o,t]),(0,k.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-1",children:t.map(((e,t)=>(0,k.jsx)(W.q7,{original:`http://192.168.1.27:8000/files/${e.hash}/download`,thumbnail:`http://192.168.1.27:8000/files/thumbnail/photo/download?hash=${e.hash}&width=400&height=300`,width:e.width,alt:`${e.filename}.${e.extention}`,height:e.height,caption:`${e.folder_name} - ${e.filename} (${e.height}x${e.width}) - ${JSON.parse(e.tags)}`,children:t=>{let{ref:a,open:n}=t;return(0,k.jsx)("div",{className:"cursor-pointer bg-gray-100 rounded overflow-hidden",children:(0,k.jsxs)("div",{className:"relative pb-full",children:[(0,k.jsx)("img",{ref:a,hidden:s,srcSet:`\n                                        http://192.168.1.27:8000/files/thumbnail/photo/download?hash=${e.hash}&width=150&height=200 1x,\n                                        http://192.168.1.27:8000/files/thumbnail/photo/download?hash=${e.hash}&width=400&height=300 2x\n                                    `,src:`http://192.168.1.27:8000/files/thumbnail/photo/download?hash=${e.hash}&width=400&height=300`,alt:`${e.filename}.${e.extention}`,loading:"lazy",fetchPriority:"low",onClick:n,className:"absolute inset-0 w-full h-full object-cover transition-opacity duration-300 "+(c(e.hash)?"opacity-100":"opacity-0"),onLoad:()=>{return t=e.hash,void i((e=>({...e,[t]:!0})));var t}}),!c(e.hash)&&(0,k.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100",children:(0,k.jsx)("div",{className:"w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"})})]})})}},e.hash)))})},te=e=>{let{images:t}=e;return(0,k.jsx)(W.Z2,{withCaption:!0,withDownloadButton:!0,options:{bgOpacity:1,preload:[2,4],loop:!1,pinchToClose:!1,closeOnVerticalDrag:!1},children:(0,k.jsx)("div",{children:(0,k.jsx)(ee,{images:t,hidden:!1})})})},se=(0,a.createContext)({}),ae=e=>{let{children:t}=e;const[s,n]=(0,a.useState)(!1),[r,o]=(0,a.useState)(!1),[l,i]=(0,a.useState)(!1),[c,d]=(0,a.useState)(null),[h,u]=(0,a.useState)(null),[m,g]=(0,a.useState)([]),x=(0,a.useCallback)((async e=>{const t=await N.getAll(e.title);d({...e,tags:[...t]}),n(!0)}),[]),p=(0,a.useCallback)((()=>{n(!1),d(null)}),[]),f=(0,a.useCallback)((e=>{u(e),o(!0)}),[]),b=(0,a.useCallback)((()=>{o(!1),u(null)}),[]),j=(0,a.useCallback)((async e=>{try{const t=await w.getRandomByFolder(e);t.items.length>0&&(g(t.items),i(!0))}catch(t){console.error("Error fetching random photo:",t)}}),[]),y=(0,a.useCallback)((()=>{i(!1),g([])}),[]);return(0,k.jsx)(se.Provider,{value:{tagDialogOpen:s,deleteDialogOpen:r,randomPhotoDialogOpen:l,selectedFolder:c,folderToDelete:h,randomPhotos:m,openTagDialog:x,closeTagDialog:p,openDeleteDialog:f,closeDeleteDialog:b,openRandomPhotos:j,closeRandomPhotos:y},children:t})},ne=()=>(0,a.useContext)(se),re=e=>{let{photos:t}=e;const{closeRandomPhotos:s}=ne();return(0,a.useEffect)((()=>()=>{s()}),[s]),(0,k.jsx)(W.Z2,{withCaption:!0,withDownloadButton:!0,onOpen:e=>{e.on("close",(()=>{console.log("CLOSED CALLED"),s()}))},options:{bgOpacity:1,preload:[2,4],loop:!1,pinchToClose:!1,closeOnVerticalDrag:!1},children:(0,k.jsx)("div",{children:(0,k.jsx)(ee,{images:t,hidden:!0,openNow:!0})})})},oe=e=>{let{onLoadMore:t,hasMore:s,loading:n}=e;const r=(0,a.useRef)(null),o=(0,a.useCallback)((e=>{n||(r.current&&r.current.disconnect(),r.current=new IntersectionObserver((e=>{e[0].isIntersecting&&s&&t()})),e&&r.current.observe(e))}),[n,s,t]);return(0,a.useEffect)((()=>()=>{r.current&&r.current.disconnect()}),[]),o},le=()=>{const[e,t]=(0,a.useState)(!1),{filteredFolders:s,loading:n,searchQuery:o,selectedRoot:l,setSearchQuery:i,setSelectedRoot:c,deleteFolder:d,startIndexation:h,isIndexing:u,hasMore:m,loadMoreFolders:g}=E(),{tagDialogOpen:x,deleteDialogOpen:p,randomPhotoDialogOpen:f,selectedFolder:b,folderToDelete:j,randomPhotos:y,openTagDialog:v,closeTagDialog:w,openDeleteDialog:N,closeDeleteDialog:C,openRandomPhotos:S}=ne(),A=(0,r.Zp)(),I=M(),[P,T]=(0,r.ok)(),z=oe({onLoadMore:g,hasMore:m,loading:n});(0,a.useEffect)((()=>{const e=P.get("root");e&&e!==l?c(e):!e&&l&&$(l)}),[]),(0,a.useEffect)((()=>{const e=P.get("searchBy");e&&e!==o?i(e):!e&&o&&O(o)}),[]),(0,a.useEffect)((()=>{$(l)}),[l]);const $=e=>{e?T({root:e}):(P.delete("root"),T(P))},O=e=>{e?T({searchBy:e}):(P.delete("searchBy"),T(P))},D=(e,t)=>{"tag"===e?A(`/tag/${t}`):"root"===e&&c(t)},R=e=>{A(`/folder/${e}`)},F=()=>{A("/api-docs")};return(0,k.jsxs)("div",{className:"min-h-screen bg-gray-100 mobile-safe-bottom",children:[(0,k.jsxs)("div",{className:"container mx-auto p-4",children:[(0,k.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"Gallery NAS"}),(0,k.jsx)(B,{onTagClick:D,onApiDocsClick:F,isOpen:e,onClose:()=>t(!1)}),0===s.length&&(0,k.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-8 text-center",children:[(0,k.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"No folders found"}),(0,k.jsx)("p",{className:"text-gray-600",children:l?`No folders in folder "${l}"${o?` matching "${o}"`:""}`:`No folders match your search criteria "${o}"`}),(0,k.jsxs)("div",{className:"mt-4 flex flex-col md:flex-row justify-center gap-2",children:[o&&(0,k.jsx)("button",{onClick:()=>i(""),className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition",children:"Clear Search"}),l&&(0,k.jsx)("button",{onClick:()=>c(""),className:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition",children:"Show All Roots"})]})]}),(0,k.jsx)("div",{className:"grid grid-cols-1 "+(I?"gap-4":"md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-2"),children:s.map((e=>(0,k.jsx)(J,{folder:e,onView:R,onTagClick:D,onTagManage:v,onRandomPhoto:S,onDelete:N},e.title)))}),m&&(0,k.jsx)("div",{ref:z,className:"flex justify-center items-center py-8 mb-16",children:n&&(0,k.jsx)("div",{className:"w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"})})]}),I&&(0,k.jsx)("div",{className:"z-50 fixed bottom-0 left-0 right-0 bg-white shadow-t-lg",children:(0,k.jsx)(V,{onHomeClick:()=>{A("/"),c(""),i("")},onRootClick:()=>t(!0),onTagsClick:()=>t(!0),onIndexClick:h,onApiDocsClick:F,isIndexing:u})}),x&&b&&(0,k.jsx)(G,{folder:b,onCancel:w,onSave:w}),p&&j&&(0,k.jsx)(X,{folder:j,onCancel:C,onConfirm:async()=>{j&&(await d(j.title),C())}}),f&&y&&(0,k.jsx)(re,{photos:y})]})},ie=()=>{const[e,t]=(0,a.useState)([]),[s,n]=(0,a.useState)(1),[o,l]=(0,a.useState)(!1),[i,c]=(0,a.useState)(!0),[d,h]=(0,a.useState)(!0),[u,m]=(0,a.useState)(null),{folderName:g}=(0,r.g)(),x=(0,r.Zp)(),p=M(),{isIndexing:f,startIndexation:b}=E(),j=async()=>{if(g&&i&&!d){h(!0);try{const e=await w.getAllByFolder(g,200,s);(!e.items.length||e.items.length<200)&&c(!1),t((t=>[...t,...e.items])),n((e=>e+1))}catch(e){console.error("Failed to fetch more photos:",e),c(!1)}finally{h(!1)}}},y=oe({onLoadMore:j,hasMore:i,loading:d});(0,a.useEffect)((()=>{g&&(h(!0),t([]),n(1),c(!0),v.getByName(g).then((async e=>{e&&(e.tags=await N.getAll(e.title),m(e))})).catch((e=>console.error("Failed to fetch folder details:",e))).finally((()=>h(!1))))}),[g]),(0,a.useEffect)((()=>{g&&j()}),[g]);const C=()=>{null!==u&&void 0!==u&&u.root?x(`/?root=${u.root}`):x("/")},S=(e,t)=>{"tag"===e?x(`/tag/${t}`):"root"===e&&x("/",{state:{selectedRoot:t}})},A=()=>{x("/api-docs")};return!e.length&&d?(0,k.jsx)("div",{className:"flex justify-center items-center h-64",children:"Loading photos..."}):(0,k.jsxs)("div",{className:"min-h-screen bg-gray-100 mobile-safe-bottom",children:[(0,k.jsxs)("div",{className:"container mx-auto p-4",children:[(0,k.jsx)(B,{onTagClick:S,onApiDocsClick:A}),(0,k.jsxs)("div",{className:"container mx-auto p-4",children:[(0,k.jsxs)("div",{className:"flex items-center mb-6",children:[(0,k.jsx)("button",{onClick:C,className:"mr-4 px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 transition",children:"Back"}),(0,k.jsx)("button",{onClick:()=>{l(!o)},className:"mr-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-gray-300 transition",children:"Show everything"}),(0,k.jsx)("h1",{className:"text-3xl font-bold",children:(null===u||void 0===u?void 0:u.title)||"Album"}),(null===u||void 0===u?void 0:u.root)&&(0,k.jsx)("span",{className:"ml-4 px-3 py-1 bg-blue-500 text-white text-sm rounded-full cursor-pointer hover:bg-blue-600",onClick:()=>S("root",u.root),children:u.root})]}),(0,k.jsx)(te,{images:e}),i&&(0,k.jsx)("div",{ref:y,className:"flex justify-center items-center py-8",children:d&&(0,k.jsx)("div",{className:"w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"})})]})]}),p&&(0,k.jsx)(V,{onHomeClick:C,onRootClick:()=>{x("/",{state:{showRoots:!0}})},onTagsClick:()=>{x("/")},onIndexClick:b,onApiDocsClick:A,isIndexing:f})]})},ce=()=>{const{tagName:e}=(0,r.g)(),[t,s]=(0,a.useState)([]),[n,o]=(0,a.useState)(!1),[l,i]=(0,a.useState)(!0),[c,d]=(0,a.useState)(!0),[h,u]=(0,a.useState)(null),m=(0,r.Zp)(),g=async()=>{if(e&&l&&!c){d(!0);try{const t=await w.getRandomByTag(e,300,!0);0===t.items.length&&i(!1),s((e=>[...e,...t.items]))}catch(t){console.error("Failed to fetch more photos:",t),i(!1)}finally{d(!1)}}},x=oe({onLoadMore:g,hasMore:l,loading:c});(0,a.useEffect)((()=>{e&&g()}),[e]);const p=(e,t)=>{"tag"===e?m(`/tag/${t}`):"root"===e&&m("/",{state:{selectedRoot:t}})};return!t.length&&c?(0,k.jsx)("div",{className:"flex justify-center items-center h-64",children:"Loading photos..."}):(0,k.jsx)("div",{className:"min-h-screen bg-gray-100 mobile-safe-bottom",children:(0,k.jsxs)("div",{className:"container mx-auto p-4",children:[(0,k.jsx)(B,{onTagClick:p,onApiDocsClick:()=>{m("/api-docs")}}),(0,k.jsxs)("div",{className:"container mx-auto p-4",children:[(0,k.jsxs)("div",{className:"flex items-center mb-6",children:[(0,k.jsx)("button",{onClick:()=>{null!==h&&void 0!==h&&h.root?m(`/?root=${h.root}`):m("/")},className:"mr-4 px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 transition",children:"Back"}),(0,k.jsx)("button",{onClick:()=>{o(!n)},className:"mr-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-gray-300 transition",children:"Show everything"}),(0,k.jsx)("h1",{className:"text-3xl font-bold",children:(null===h||void 0===h?void 0:h.title)||"Album"}),(null===h||void 0===h?void 0:h.root)&&(0,k.jsx)("span",{className:"ml-4 px-3 py-1 bg-blue-500 text-white text-sm rounded-full cursor-pointer hover:bg-blue-600",onClick:()=>p("root",h.root),children:h.root})]}),(0,k.jsx)(te,{images:t}),l&&(0,k.jsx)("div",{ref:x,className:"flex justify-center items-center py-8",children:c&&(0,k.jsx)("div",{className:"w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"})})]})]})})};var de=s(68308),he=(s(50928),s(23877)),ue=s(1247);const me=e=>{let{specUrl:t,onBack:s}=e;const[n,r]=(0,a.useState)(null),[o,i]=(0,a.useState)(!0),[c,d]=(0,a.useState)(null);return(0,a.useEffect)((()=>{(async()=>{i(!0),d(null);try{const e=await g.A.get(t);r(e.data),i(!1)}catch(e){console.error("Error fetching OpenAPI spec:",e),d("Failed to load API documentation. Please try again later."),i(!1)}})()}),[t]),(0,k.jsxs)("div",{className:"swagger-container bg-white rounded-lg shadow-md p-4 overflow-hidden",children:[s&&(0,k.jsxs)("button",{onClick:s,className:"mb-4 px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 transition flex items-center",children:[(0,k.jsx)(he.A,{size:16,className:"mr-2"})," Back to Albums"]}),(0,k.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"API Documentation"}),o&&(0,k.jsxs)("div",{className:"flex items-center justify-center h-64",children:[(0,k.jsx)(l.A,{size:32,className:"animate-spin text-blue-500"}),(0,k.jsx)("span",{className:"ml-2 text-lg",children:"Loading API documentation..."})]}),c&&(0,k.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4 flex items-start",children:[(0,k.jsx)(ue.A,{size:20,className:"text-red-500 mt-0.5 mr-3 flex-shrink-0"}),(0,k.jsxs)("div",{children:[(0,k.jsx)("h3",{className:"text-red-800 font-medium",children:"Error Loading Documentation"}),(0,k.jsx)("p",{className:"text-red-700 mt-1",children:c}),(0,k.jsx)("button",{onClick:()=>window.location.reload(),className:"mt-3 px-4 py-1.5 bg-red-100 text-red-800 rounded hover:bg-red-200 transition",children:"Retry"})]})]}),!o&&!c&&n&&(0,k.jsx)("div",{className:"swagger-ui-wrapper overflow-auto",children:(0,k.jsx)(de.A,{spec:n,docExpansion:"list",filter:!0})})]})},ge=()=>{const e=(0,r.Zp)(),t=M(),{isIndexing:s,startIndexation:a}=E(),n=()=>{e("/")};return(0,k.jsxs)("div",{className:"min-h-screen bg-gray-100 mobile-safe-bottom",children:[(0,k.jsx)("div",{className:"container mx-auto p-4",children:(0,k.jsx)(me,{specUrl:"http://192.168.1.27:8000/openapi.json",onBack:n})}),t&&(0,k.jsx)(V,{onHomeClick:n,onRootClick:()=>{e("/",{state:{showRoots:!0}})},onTagsClick:()=>{e("/")},onIndexClick:a,onApiDocsClick:()=>{},isIndexing:s})]})},xe=()=>(0,k.jsxs)(r.BV,{children:[(0,k.jsx)(r.qh,{path:"/",element:(0,k.jsx)(le,{})}),(0,k.jsx)(r.qh,{path:"/folder/:folderName",element:(0,k.jsx)(ie,{})}),(0,k.jsx)(r.qh,{path:"/tag/:tagName",element:(0,k.jsx)(ce,{})}),(0,k.jsx)(r.qh,{path:"/api-docs",element:(0,k.jsx)(ge,{})}),(0,k.jsx)(r.qh,{path:"*",element:(0,k.jsx)(r.C5,{to:"/",replace:!0})})]}),pe=()=>(0,k.jsx)(r.Kd,{children:(0,k.jsx)(A,{children:(0,k.jsx)(ae,{children:(0,k.jsx)(xe,{})})})});var fe=s(91179);const be=function(e){e&&"function"===typeof e&&((0,fe.IN)(e),(0,fe.lt)(e),(0,fe.fK)(e),(0,fe.zB)(e),(0,fe.Ck)(e))};n.createRoot(document.getElementById("root")).render((0,k.jsx)(a.StrictMode,{children:(0,k.jsx)(pe,{})})),be(console.log)}},t={};function s(a){var n=t[a];if(void 0!==n)return n.exports;var r=t[a]={id:a,loaded:!1,exports:{}};return e[a].call(r.exports,r,r.exports,s),r.loaded=!0,r.exports}s.m=e,(()=>{var e=[];s.O=(t,a,n,r)=>{if(!a){var o=1/0;for(d=0;d<e.length;d++){a=e[d][0],n=e[d][1],r=e[d][2];for(var l=!0,i=0;i<a.length;i++)(!1&r||o>=r)&&Object.keys(s.O).every((e=>s.O[e](a[i])))?a.splice(i--,1):(l=!1,r<o&&(o=r));if(l){e.splice(d--,1);var c=n();void 0!==c&&(t=c)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[a,n,r]}})(),s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;s.t=function(a,n){if(1&n&&(a=this(a)),8&n)return a;if("object"===typeof a&&a){if(4&n&&a.__esModule)return a;if(16&n&&"function"===typeof a.then)return a}var r=Object.create(null);s.r(r);var o={};e=e||[null,t({}),t([]),t(t)];for(var l=2&n&&a;"object"==typeof l&&!~e.indexOf(l);l=t(l))Object.getOwnPropertyNames(l).forEach((e=>o[e]=()=>a[e]));return o.default=()=>a,s.d(r,o),r}})(),s.d=(e,t)=>{for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e={792:0};s.O.j=t=>0===e[t];var t=(t,a)=>{var n,r,o=a[0],l=a[1],i=a[2],c=0;if(o.some((t=>0!==e[t]))){for(n in l)s.o(l,n)&&(s.m[n]=l[n]);if(i)var d=i(s)}for(t&&t(a);c<o.length;c++)r=o[c],s.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return s.O(d)},a=self.webpackChunkphoto_album_portal=self.webpackChunkphoto_album_portal||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var a=s.O(void 0,[967,980,173,96],(()=>s(74305)));a=s.O(a)})();
//# sourceMappingURL=main.7902dbc8.js.map